<!DOCTYPE html>
    <html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#f8b500" />
    <title>Happy Birthday Papa!</title>
    <style>
        :root {
            --bg-1: #fceabb;
            --bg-2: #f8b500;
            --ink: #3a1f0b;
            --panel: rgba(255 255 255 / 0.7);
            --shadow: 0 6px 18px rgba(0,0,0,0.18);
            --radius: 16px;
            --gap: 14px;
            --accent: #d99500;
        }

        /* Base */
        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            margin: 0;
            background: linear-gradient(135deg, var(--bg-1), var(--bg-2));
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
            color: var(--ink);
            display: grid;
            grid-template-rows: auto 1fr auto;
            min-height: 100vh;
        }
        header, footer {
            padding: 1rem 1.25rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        header h1 {
            margin: 0;
            font-size: clamp(2rem, 6vw, 3.5rem);
            text-align: center;
            text-shadow: 2px 2px 8px #b37400aa;
        }
        main {
            padding: 2.2rem 1.5rem 2.5rem 1.5rem;
            display: grid;
            grid-template-columns: 1fr;
            gap: calc(var(--gap) * 2.1);
            width: min(1100px, 100%);
            margin: 0 auto;
            justify-items: center;
        }
        @media (min-width: 880px) {
            main {
                grid-template-columns: 1.2fr 1fr;
                align-items: stretch;
                gap: calc(var(--gap) * 2.2) calc(var(--gap) * 2.5);
            }
        }

        .card {
            background: var(--panel);
            backdrop-filter: blur(6px);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.25rem 1.1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 600px;
        }
        @media (min-width: 880px) {
            .card {
                max-width: unset;
                width: 100%;
            }
            #wishBox.card, #galleryWrap.card {
                min-width: 0;
            }
        }

        /* Wishes */
        #wishBox {
            display: grid;
            gap: calc(var(--gap) * 1.2);
            width: 100%;
            justify-items: center;
        }
        #wish {
            min-height: 260px;
            display: grid;
            place-items: center;
            font-size: clamp(1.23rem, 2.8vw, 1.7rem);
            padding: 2.5rem 2rem;
            border-radius: 14px;
            background: rgba(255,255,255,0.83);
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);
            text-align: center;
            word-break: break-word;
            width: 100%;
            max-width: 510px;
            margin: 0 auto;
        }
        .actions { display: flex; flex-wrap: wrap; gap: 10px; }
        button, .btn {
            background-color: var(--bg-2);
            border: none;
            padding: 0.8rem 1.1rem;
            font-size: 1rem;
            border-radius: 999px;
            cursor: pointer;
            color: var(--ink);
            font-weight: 700;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transition: transform .15s ease, filter .2s ease;
        }
        button:hover { transform: translateY(-1px); filter: brightness(.98); }
        button:active { transform: translateY(0); }
        .btn-ghost { background: transparent; box-shadow: none; border: 2px solid var(--ink); }
        .btn-muted { background: #fff2cc; }

        /* Add wish */
        form#addWish { display: grid; gap: 8px; }
        form#addWish input {
            width: 100%;
            padding: 0.8rem 0.95rem;
            border-radius: 12px;
            border: 1.5px solid #00000022;
            outline: none;
            font-size: 1rem;
            background: white;
        }

        /* Gallery */
        #galleryWrap {
            display: grid;
            gap: calc(var(--gap) * 1.1);
            width: 100%;
            justify-items: center;
        }
        #gallery {
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: var(--shadow);
            background: #ffffffa6;
        }
        #gallery img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity .5s ease;
            cursor: pointer;
            user-select: none;
            will-change: opacity;
        }
        #gallery img.active { opacity: 1; }
        /* #gallery img.tilt removed */
        .nav {
            position: absolute;
            top: 50%;
            left: 0;
            translate: 0 -50%;
            display: grid;
            place-items: center;
            width: 42px; height: 42px;
            border-radius: 50%;
            background: rgba(248,181,0,.9);
            color: var(--ink);
            font-weight: 900;
            border: none; cursor: pointer; user-select: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            z-index: 10;
        }
        .nav:hover { filter: brightness(.95); }
        #prev { left: 10px; right: auto; }
        #next { right: 10px; left: auto; }
        .progress {
            position: absolute;
            left: 8px; right: 8px; bottom: 8px;
            height: 6px;
            background: rgba(0,0,0,0.15);
            border-radius: 999px;
            overflow: hidden;
        }
        .progress > i { display: block; height: 100%; width: 0%; background: var(--bg-2); }

        /* Dropzone */
        .dropzone {
            border: 2px dashed rgba(0,0,0,.25);
            border-radius: 12px;
            padding: .9rem;
            text-align: center;
            background: rgba(255,255,255,.6);
        }

        /* Lightbox */
        dialog#lightbox {
            /* Fullscreen overlay, modern look */
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
            background: rgba(0,0,0,0.85);
            border: none;
            border-radius: 0;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        dialog#lightbox::backdrop { background: rgba(0,0,0,.85); }
        .lightbox-inner {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .lightbox-inner img {
            display: block;
            max-width: 100vw;
            max-height: 90vh;
            margin: 0 auto;
            border-radius: 14px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.32);
            background: #fff;
            transition: opacity .35s cubic-bezier(.4,0,.2,1), transform .35s cubic-bezier(.4,0,.2,1);
            opacity: 1;
            transform: scale(1);
        }
        dialog[open] .lightbox-inner img {
            opacity: 1;
            transform: scale(1);
        }
        .lightbox-close {
            position: absolute;
            top: 28px;
            right: 32px;
            background: rgba(255,255,255,0.72);
            border: none;
            border-radius: 999px;
            width: 44px;
            height: 44px;
            font-size: 1.6rem;
            color: #222;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.09);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.18s;
            z-index: 20;
        }
        .lightbox-close:hover, .lightbox-close:focus {
            background: rgba(255,255,255,0.93);
        }
        .lightbox-prev, .lightbox-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.25);
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            font-size: 2.1rem;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.16);
            opacity: 0;
            transition: opacity 0.22s, background 0.18s;
            z-index: 10;
        }
        .lightbox-prev:hover, .lightbox-next:hover, .lightbox-prev:focus, .lightbox-next:focus {
            background: rgba(255,255,255,0.45);
            color: #222;
        }
        .lightbox-prev { left: 24px; }
        .lightbox-next { right: 24px; }
        dialog#lightbox:hover .lightbox-prev,
        dialog#lightbox:hover .lightbox-next,
        dialog#lightbox:focus-within .lightbox-prev,
        dialog#lightbox:focus-within .lightbox-next {
            opacity: 1;
        }
        @media (max-width: 700px) {
            .lightbox-inner img {
                max-width: 100vw;
                max-height: 60vh;
                border-radius: 8px;
            }
            .lightbox-close {
                top: 12px;
                right: 12px;
                width: 38px;
                height: 38px;
                font-size: 1.3rem;
            }
            .lightbox-prev, .lightbox-next {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
                top: unset;
                bottom: 18px;
                transform: none;
                opacity: 1;
                background: rgba(255,255,255,0.32);
            }
            .lightbox-prev { left: 18vw; right: auto; }
            .lightbox-next { right: 18vw; left: auto; }
        }

        /* Confetti Canvas */
        #confettiCanvas { position: fixed; inset: 0; pointer-events: none; }

        /* Footer */
        footer {
            width: 100%;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 1.22rem;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(90deg, #f8b500e6 0%, #fceabbcc 100%);
            box-shadow: 0 -1px 12px #f8b50044;
            opacity: 1;
            letter-spacing: 0.01em;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            margin-top: 1.5rem;
            min-height: 3.5rem;
            backdrop-filter: blur(3px);
        }

        /* Quote Block */
        #zitat-block {
            margin-top: 1.7rem !important;
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #zitat-block blockquote {
            font-size: 1.35rem;
            font-style: italic;
            text-align: center;
            padding: 1.2rem 1.2rem;
            margin: 0;
            line-height: 1.7;
            width: 100%;
            max-width: 460px;
        }
        @media (max-width: 600px) {
            #zitat-block blockquote {
                font-size: 1.08rem;
                padding: 1rem 0.5rem;
            }
        }

        /* Personal Message */
        #personal-message {
            margin-top: 1.5rem !important;
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #personal-message p {
            font-size: 1.19rem;
            line-height: 1.7;
            margin: 0;
            text-align: center;
        }
        @media (max-width: 700px) {
            #personal-message p {
                font-size: 1.05rem;
            }
        }

        /* Print a nice card */
        @media print {
            header, .controls, .dropzone, #prev, #next, .progress, footer, #confettiCanvas { display: none !important; }
            body { background: white; }
            .card { box-shadow: none; background: white; }
            #wish { border: 2px solid #00000022; }
        }

        /* Mobile optimizations */
        @media (max-width: 500px) {
            body {
                padding: 1rem;
            }
            main {
                padding: 1rem 0.2rem 1.3rem 0.2rem;
                gap: 1.1rem;
            }
            header {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.9rem 0.5rem;
            }
            header h1 {
                font-size: 1.6rem;
            }
            #countdown {
                font-size: 1rem !important;
                margin-top: 0.7rem !important;
            }
            .card {
                padding: 1rem 0.5rem;
                border-radius: 10px;
                max-width: 100%;
            }
            #wish {
                min-height: 180px;
                font-size: 1rem;
                padding: 1.1rem 0.6rem;
                border-radius: 10px;
            }
            #wishBox {
                gap: 0.8rem;
            }
            .actions {
                flex-direction: column;
                align-items: stretch;
                gap: 0.6rem;
            }
            button, .btn {
                width: 100%;
                min-width: 0;
                font-size: 1rem;
            }
            #gallery {
                aspect-ratio: 4/3;
                border-radius: 10px;
            }
            .nav {
                width: 32px;
                height: 32px;
                font-size: 1.1rem;
            }
            .progress {
                height: 4px;
            }
            #personal-message > div {
                padding: 0.3rem 0.1rem !important;
            }
            #personal-message p {
                font-size: 1rem !important;
                padding: 0.2rem 0.1rem !important;
            }
            #zitat-block blockquote {
                font-size: 1rem !important;
                padding: 0.5rem 0.2rem !important;
            }
            footer {
                font-size: 1rem;
                padding: 0.8rem 0.3rem;
                min-height: 2.3rem;
            }
        }

        /* Motion respect */
        @media (prefers-reduced-motion: reduce) {
            .animate, .progress > i { transition: none !important; }
        }
    </style>
</head>
<body>
    <canvas id="confettiCanvas" aria-hidden="true"></canvas>

    <header>
        <h1 aria-live="polite">Happy Birthday Dad! 🎉</h1>
        <div id="countdown" style="margin-top:1rem;font-size:1.33rem;font-weight:500;text-align:center;color:#a05d00;"></div>
    </header>

    <main>
        <!-- Wishes -->
        <section class="card" id="wishBox" aria-labelledby="wishes-h">
            <h2 id="wishes-h" style="margin:0 0 .25rem 0">Birthday Wishes</h2>
            <p id="wish">Loading your wish...</p>
            <div class="actions controls" role="group" aria-label="Wish actions">
                <button id="newWishBtn" title="Random wish">New Wish</button>
                <button id="toggleConfetti" class="btn-ghost" title="Toggle confetti">Confetti: On</button>
            </div>
        </section>

        <!-- Personal Message -->
        <section class="card" id="personal-message" aria-labelledby="personal-message-h" style="margin-top:1.5rem;">
            <h2 id="personal-message-h" style="margin:0 0 .25rem 0;">Personal Message</h2>
            <div style="padding: 0.5rem 0.2rem;">
                <p style="font-size:1.18rem; line-height:1.7; margin:0;">
                    Lieber Papa,<br>
                    <br>
                    ich möchte dir nicht nur zum Geburtstag gratulieren, sondern dir auch sagen, wie dankbar ich für all die schönen Momente und deine ständige Unterstützung bin.<br>
                    <br>
                    Du bist immer für mich da gewesen, hast zugehört, geholfen und mich zum Lachen gebracht. Ich wünsche dir von Herzen Gesundheit, Freude und viele weitere unvergessliche Erlebnisse.<br>
                    <br>
                    Ich hab dich sehr lieb!<br>
                    <span style="display:inline-block;margin-top:0.6em;font-weight:600;">Dein Michi</span>
                </p>
            </div>
        </section>

        <!-- Gallery -->
        <section class="card" id="galleryWrap" aria-labelledby="gallery-h">
            <h2 id="gallery-h" style="margin:0 0 .25rem 0">Mini Gallery</h2>
            <div id="gallery" aria-live="polite">
                <button id="prev" class="nav" aria-label="Previous image">&#10094;</button>
                <button id="next" class="nav" aria-label="Next image">&#10095;</button>
                <div class="progress" aria-hidden="true"><i id="bar"></i></div>
                <img src="./Photos/01.png" alt="Photo 1" class="active" />
                <img src="./Photos/02.JPG" alt="Photo 2" />
                <img src="./Photos/03.JPG" alt="Photo 3" />
                <img src="./Photos/04.jpg" alt="Photo 4" />
                <img src="./Photos/05.jpg" alt="Photo 5" />
            </div>
            <div class="actions controls" role="group" aria-label="Slideshow">
                <button id="playPause">Autoplay: On</button>
                <button id="fullscreen">Fullscreen</button>
            </div>
        </section>

        <!-- Quote Block -->
        <section class="card" id="zitat-block" aria-labelledby="zitat-h" style="margin-top:1.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <h2 id="zitat-h" style="margin:0 0 .5rem 0; text-align:center;">Favorite Quote</h2>
            <blockquote style="font-size:1.35rem; font-style:italic; text-align:center; padding:1.2rem 1.2rem; margin:0; line-height:1.7;">
                „ick schwer, die beschte von die welt! - Papa“
            </blockquote>
        </section>

    </main>

    <footer>
        <span>Built with love by Michias – Happy Birthday Papa!</span>
    </footer>

    <dialog id="lightbox" aria-label="Enlarged view">
        <div class="lightbox-inner">
            <button class="lightbox-prev" aria-label="Previous image" tabindex="0">‹</button>
            <img alt="Enlarged view" />
            <button class="lightbox-next" aria-label="Next image" tabindex="0">›</button>
            <button class="lightbox-close" aria-label="Close" tabindex="0">✕</button>
        </div>
    </dialog>

    <!-- html2canvas CDN -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
        // Countdown Timer
        (function() {
            const countdownEl = document.getElementById('countdown');
            // Set fixed birthday: 27 September 2026
            function getNextBirthday() {
                // 27 September 2026, 00:00:00
                return new Date(2026, 8, 27, 0, 0, 0, 0); // Month is 0-based: 8 = September
            }
            function updateCountdown() {
                const now = new Date();
                const next = getNextBirthday();
                let diff = next - now;
                if (diff < 0) diff = 0;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const mins = Math.floor((diff / (1000 * 60)) % 60);
                const secs = Math.floor((diff / 1000) % 60);
                let text = '';
                if (diff === 0) {
                    text = 'Today is the birthday! 🎂';
                } else {
                    text = `Only <b>${days}</b> day${days!==1?'s':''}, <b>${hours}</b> hrs, <b>${mins}</b> min, <b>${secs}</b> sec until the next birthday!`;
                }
                countdownEl.innerHTML = text;
            }
            updateCountdown();
            setInterval(updateCountdown, 1000);
        })();

        // Utility
        function $(sel, root = document) { return root.querySelector(sel); }
        function $all(sel, root = document) { return Array.from(root.querySelectorAll(sel)); }
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        // Birthday wishes list
        const wishes = [
            "Happy Birthday, Dad! You are the best!",
            "Congratulations on your birthday! Thank you for your love and support.",
            "Wishing you health, happiness, and many wonderful moments in the coming year!",
            "Dad, you are my hero – have a fantastic birthday!",
            "May your day be as special as you are. Happy Birthday!",
            "Thank you for always being there for me. Love you!",
            "Celebrate big today – you more than deserve it!",
            "To another year full of shared memories and joy!",
            "Wishing you a day full of laughter, love, and delicious cake!",
            "Happy Birthday, Dad! You make the world brighter for us.",
            "You age like fine wine – just getting better every year!",
            "To the man, the myth, the legend – happy birthday!",
            "Hope your birthday is as cool as your dad jokes!",
            "Enjoy your day, you absolute legend!",
            "Dad, you’re not old, you’re just well seasoned!",
            "May your birthday cake be as sweet as you are!",
            "Cheers to you and all your wisdom (and snacks)!",
            "Another year, another reason to celebrate how awesome you are!",
            "Wishing you a year full of happiness, health, and naps!",
            "You’re the king of the grill and the king of our hearts.",
            "Keep calm and birthday on!",
            "You make fatherhood look easy – and fun!",
            "May your day be filled with laughter, love, and zero chores.",
            "Happy Birthday to the family’s MVP!",
            "You’re not just a year older, you’re a year cooler.",
            "Hope you get to eat all your favorite things today!",
            "To the world’s greatest dad: have a blast!",
            "May your coffee be strong and your birthday be long!",
            "Wishing you endless happiness and plenty of dad naps.",
            "You’re proof that dads only get better with age.",
            "Your hugs are the best gift – but here’s a wish too!",
            "Have a birthday as epic as your dance moves!",
            "May today be filled with all your favorite things.",
            "You’re the best at everything – especially birthdays!",
            "To the man who can fix anything – even birthdays!",
            "May you always find the remote and never run out of snacks.",
            "You’re my role model, my coach, and my favorite guy.",
            "Wishing you a birthday full of fun and zero stress.",
            "Happy Birthday to the man who taught me everything I know!",
            "You’re the captain of our ship – full speed ahead to a great year!",
            "Hope your day is as awesome as your grilling skills.",
            "To the dad who always knows the answer (or Googles it fast).",
            "May your birthday be filled with love, laughter, and cake!",
            "Thanks for all the dad jokes and life lessons.",
            "You’re the best thing since sliced bread – and you make better sandwiches too!",
            "Have a chilled, relaxed, and totally awesome birthday.",
            "To the guy who always makes us laugh – happy birthday!",
            "May your day be legendary, just like you.",
            "You put the 'rad' in 'dad'!",
            "Wishing you a day that’s as fantastic as your taste in music.",
            "Hope you get to put your feet up and relax today!",
            "To the dad who always brings the fun – have a blast!",
            "You’re not just a year older, you’re a year wiser (and funnier).",
            "Wishing you an endless supply of your favorite snacks!",
            "May your birthday be the start of your best year yet.",
            "You’re the family’s rock – hope your day rocks too!",
            "Here’s to you, your stories, and your epic dad jokes.",
            "You deserve all the good things today – and every day!",
            "Hope your day is full of surprises (the good kind).",
            "To the man who can do it all – happy birthday!",
            "May your birthday be filled with good vibes and great company.",
            "You make every day brighter – especially today!",
            "Wishing you a birthday that’s as cool as your sock collection.",
            "You’re the GOAT – Greatest Of All Time!",
            "To the dad who’s always up for an adventure.",
            "May all your birthday wishes come true (except the embarrassing ones).",
            "You’re the best dad – hands down, no contest.",
            "Hope your day is full of laughs and good cheer.",
            "You’re always there for us – now let us celebrate you!",
            "To the guy who makes every day awesome.",
            "May your birthday be as epic as your dad skills.",
            "You’re a classic – and classics never go out of style.",
            "Wishing you a day of relaxation and zero responsibilities.",
            "You’re the family’s superhero – cape or not!",
            "Hope you get to do all your favorite things today.",
            "To the dad who never runs out of patience (or dad jokes).",
            "You make life sweeter – have an extra slice of cake!",
            "Wishing you lots of love, laughter, and good food.",
            "You’re the best listener, teacher, and friend.",
            "May your birthday be as fun as your childhood pranks.",
            "You’re the heart of our family – happy birthday!",
            "Hope your day is filled with smiles and happy memories.",
            "You’re the master of the BBQ and the king of birthdays.",
            "May your birthday be full of joy, love, and good company.",
            "You’re the best at embarrassing us – and we love you for it!",
            "Wishing you a birthday that’s as awesome as your dad skills.",
            "You’re my favorite superhero (and you don’t even need a cape).",
            "Hope your day is as cool as your puns.",
            "You’re the best dad anyone could wish for.",
            "Wishing you a year full of laughter, adventure, and happiness.",
            "You’re not just my dad, you’re my best friend.",
            "May your day be filled with everything you love.",
            "Hope your birthday is full of fun, food, and family.",
            "To the world’s greatest role model – happy birthday!",
            "You’re the reason our family is so awesome.",
            "Hope today brings you as much happiness as you’ve given us.",
            "You’re a legend, Dad – have a legendary birthday!",
            "Wishing you a day that’s as amazing as you are.",
            "You make every day an adventure – enjoy your special day!",
            "Happy birthday to the king of dad jokes!",
            "You’re the best at making us laugh – keep it up!",
            "May your birthday be filled with good food and great company.",
            "You’re the dad everyone wishes they had.",
            "Hope your birthday is as joyful as your spirit.",
            "To the man who can fix anything – even birthdays!",
            "You’re the best gift we could ever ask for.",
            "Wishing you a day of relaxation, laughter, and love.",
            "You’re the best, Dad – today and every day!",
            "Here’s to you and another awesome year ahead!",
            "Happy birthday to the coolest dad in the universe!"
        ];
        const wishEl = $('#wish');
        const nextBtn = $('#newWishBtn');
        const toggleConfettiBtn = $('#toggleConfetti');

        let availableWishes = [];
        function refillWishes() {
            availableWishes = [...wishes];
        }
        function showRandomWish() {
            if (availableWishes.length === 0) refillWishes();
            const idx = Math.floor(Math.random() * availableWishes.length);
            const text = availableWishes.splice(idx, 1)[0];
            wishEl.textContent = text;
        }

        nextBtn.addEventListener('click', showRandomWish);

        refillWishes();
        showRandomWish();

        // Gallery logic
        const gallery = $('#gallery');
        const images = () => $all('#gallery img');
        const prev = $('#prev');
        const next = $('#next');
        const bar = $('#bar');
        const playPause = $('#playPause');
        const fullscreenBtn = $('#fullscreen');
        let currentIndex = 0;
        let autoplay = !prefersReduced;
        let intervalMs = 3500;
        let timer = null;
        let progressTimer = null;

        function showImage(index) {
            const list = images();
            if (list.length === 0) return;
            index = (index + list.length) % list.length;
            list.forEach((img, i) => img.classList.toggle('active', i === index));
            currentIndex = index;
            resetProgress();
        }
        function nextImage() { showImage(currentIndex + 1); }
        function prevImage() { showImage(currentIndex - 1); }

        function startAutoplay() {
            stopAutoplay();
            if (!autoplay) return;
            timer = setInterval(() => {
                nextImage();
            }, intervalMs);
            startProgress();
        }
        function stopAutoplay() {
            if (timer) clearInterval(timer);
            timer = null;
            stopProgress();
        }
        function toggleAutoplay() {
            autoplay = !autoplay;
            playPause.textContent = `Autoplay: ${autoplay ? 'On' : 'Off'}`;
            autoplay ? startAutoplay() : stopAutoplay();
        }
        function startProgress() {
            stopProgress();
            let start = performance.now();
            function tick(now) {
                const p = Math.min(1, (now - start) / intervalMs);
                bar.style.width = (p * 100).toFixed(1) + '%';
                // Only continue if timer is active and autoplay is on
                if (p < 1 && timer && autoplay) {
                    progressTimer = requestAnimationFrame(tick);
                }
            }
            progressTimer = requestAnimationFrame(tick);
        }
        function stopProgress() {
            if (progressTimer) cancelAnimationFrame(progressTimer);
            progressTimer = null;
            bar.style.width = '0%';
        }
        function resetProgress() {
            stopProgress();
            if (timer && autoplay) startProgress();
        }


        prev.addEventListener('click', () => {
            prevImage();
            resetProgress();
        });
        next.addEventListener('click', () => {
            nextImage();
            resetProgress();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') { next.click(); }
            if (e.key === 'ArrowLeft') { prev.click(); }
        });
        playPause.addEventListener('click', () => { toggleAutoplay(); });


        // Fullscreen / Lightbox
        const lightbox = $('#lightbox');
        const lbImg = $('img', lightbox);
        const lbClose = $('.lightbox-close', lightbox);
        const lbPrev = $('.lightbox-prev', lightbox);
        const lbNext = $('.lightbox-next', lightbox);

        // Lightbox should NOT be open by default or on page load.
        // Only openLightbox on gallery image click.
        function openLightbox(index) {
            // Clamp index and show image in lightbox
            const imgs = images();
            if (!imgs.length) return;
            currentIndex = ((index % imgs.length) + imgs.length) % imgs.length;
            lbImg.src = imgs[currentIndex].src;
            lbImg.alt = imgs[currentIndex].alt || "Enlarged view";
            if (typeof lightbox.showModal === 'function') lightbox.showModal();
        }

        // Only open lightbox on gallery image click
        gallery.addEventListener('click', (e) => {
            const img = e.target.closest('img');
            if (!img) return;
            const imgs = images();
            const idx = imgs.indexOf(img);
            if (idx !== -1) openLightbox(idx);
        });

        // Lightbox navigation
        function lightboxShowRelative(d) {
            const imgs = images();
            if (!imgs.length) return;
            let idx = ((currentIndex + d) % imgs.length + imgs.length) % imgs.length;
            lbImg.src = imgs[idx].src;
            lbImg.alt = imgs[idx].alt || "Enlarged view";
            currentIndex = idx;
        }
        lbPrev.addEventListener('click', (e) => {
            e.stopPropagation();
            lightboxShowRelative(-1);
        });
        lbNext.addEventListener('click', (e) => {
            e.stopPropagation();
            lightboxShowRelative(1);
        });
        lbClose.addEventListener('click', () => lightbox.close());

        // Fullscreen button: only use Fullscreen API for desktop, no lightbox on mobile
        fullscreenBtn.addEventListener('click', () => {
            // Only use Fullscreen API on desktop (not mobile/touch devices)
            // Detect mobile by touch support (not perfect, but practical here)
            const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 1;
            if (isMobile) return;
            if (!document.fullscreenElement) {
                if (gallery.requestFullscreen) gallery.requestFullscreen();
                else if (gallery.webkitRequestFullscreen) gallery.webkitRequestFullscreen();
                else if (gallery.msRequestFullscreen) gallery.msRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                else if (document.msExitFullscreen) document.msExitFullscreen();
            }
        });

        // Keyboard support for lightbox
        lightbox.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                e.preventDefault();
                lightbox.close();
            }
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                lbPrev.click();
            }
            if (e.key === 'ArrowRight') {
                e.preventDefault();
                lbNext.click();
            }
        });

        // Clicking outside the .lightbox-inner or on dialog backdrop closes lightbox
        lightbox.addEventListener('click', (e) => {
            const inner = $('.lightbox-inner', lightbox);
            // Only close if click is on dialog itself (not bubbled from inner)
            if (e.target === lightbox) {
                lightbox.close();
            }
        });
        // Prevent click events on .lightbox-inner or its children from closing lightbox
        $('.lightbox-inner', lightbox).addEventListener('click', (e) => {
            e.stopPropagation();
        });


        // Confetti (Canvas, lightweight)
        const confettiCanvas = $('#confettiCanvas');
        const ctx = confettiCanvas.getContext('2d');
        let confettiEnabled = !prefersReduced;
        let confettiPieces = [];
        function resizeCanvas() { confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight; }
        addEventListener('resize', resizeCanvas); resizeCanvas();
        function spawnPiece() {
            return {
                x: Math.random() * confettiCanvas.width,
                y: -10,
                s: 5 + Math.random() * 7,
                vy: 60 + Math.random() * 80,
                vx: -30 + Math.random() * 60,
                r: Math.random() * Math.PI,
                vr: (-1 + Math.random() * 2) * 2,
                c: ['#f8b500','#fceabb','#f4a261','#e76f51','#264653'][Math.floor(Math.random()*5)]
            };
        }
        function initConfetti(n = 120) { confettiPieces = Array.from({length: n}, spawnPiece); }
        function stepConfetti(dt) {
            ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
            for (const p of confettiPieces) {
                p.y += p.vy * dt; p.x += p.vx * dt; p.r += p.vr * dt;
                if (p.y > confettiCanvas.height + 10) { Object.assign(p, spawnPiece(), { y: -10 }); }
                ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.r);
                ctx.fillStyle = p.c; ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s);
                ctx.restore();
            }
        }
        let last = performance.now();
        function loop(now) {
            const dt = Math.min(0.033, (now - last) / 1000); last = now;
            if (confettiEnabled) stepConfetti(dt);
            requestAnimationFrame(loop);
        }
        if (!prefersReduced) { initConfetti(); requestAnimationFrame(loop); }
        toggleConfettiBtn.addEventListener('click', () => {
            confettiEnabled = !confettiEnabled;
            toggleConfettiBtn.textContent = `Confetti: ${confettiEnabled ? 'On' : 'Off'}`;
            if (confettiEnabled && confettiPieces.length === 0) initConfetti();
            if (!confettiEnabled) ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
        });

        // Start slideshow on load
        if (autoplay) startAutoplay();

        // Simple offline capability (cache on first load)
        if ('serviceWorker' in navigator) {
            try {
                const swBlob = new Blob([
                    `self.addEventListener('install', e=>{e.waitUntil(caches.open('hb-v1').then(c=>c.addAll(['./'])))});\nself.addEventListener('fetch', e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))})`
                ], { type: 'text/javascript' });
                const swUrl = URL.createObjectURL(swBlob);
                navigator.serviceWorker.register(swUrl);
            } catch {}
        }
    </script>
</body>
</html>
